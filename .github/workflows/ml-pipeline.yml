name: MLOps NLP Pipeline CI  

on:
  push:  
    branches: [ develop, main ]  

jobs:

  lint:  
    runs-on: ubuntu-latest 

    steps:  
      - name: Checkout code  
        uses: actions/checkout@v4 

      - name: Setup Python  
        uses: actions/setup-python@v5 
        with:
          python-version: '3.10' 

      - name: Install dependencies  
        run: |
          python -m pip install --upgrade pip  # Met à jour pip
          pip install -r requirements.txt  # Installe les librairies du projet
          pip install flake8  # Installe l’outil de linting

      - name: Run Lint  # Lancer l’analyse du code
        run: flake8 . --ignore=F401,E501,W291,W292,E302,E225,E226,E111,E117,E265,W293,W391

  test: 
    runs-on: ubuntu-latest  
    needs: lint 
    steps:
      - name: Checkout code  
        uses: actions/checkout@v4  

      - name: Setup Python  
        uses: actions/setup-python@v5 
        with:
          python-version: '3.10'  

      - name: Install dependencies  
        run: |
          python -m pip install --upgrade pip  # Update pip
          pip install -r requirements.txt  # Installe les dépendances
          pip install pytest  # Installe pytest pour les tests

      - name: Run unit tests  # Exécuter les tests
        run: PYTHONPATH=. pytest tests/

  build-docker: 
    runs-on: ubuntu-latest  
    needs: test 

    steps:
      - name: Checkout code 
        uses: actions/checkout@v4  

      - name: Build Docker Image 
        run: |
          docker build -t nlp-ticket-classifier . 
            
